<script src="https://code.jquery.com/jquery-3.1.1.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>
<script src='https://api.mapbox.com/mapbox-gl-js/v0.28.0/mapbox-gl.js'></script>
<link href='https://api.mapbox.com/mapbox-gl-js/v0.28.0/mapbox-gl.css' rel='stylesheet' />
<style>

body {
    display: block;
    margin: 0px;
}

#map {
    width: 100%;
    height: calc(100vh - 105px - 37px);
    margin: 0px;
/*    margin-bottom: 45px;
*/}

#map canvas {
    cursor: crosshair;
}


.map-overlay-yearsliderbox {
    font: 12px/20px 'Helvetica Neue', Arial, Helvetica, sans-serif;
    position: absolute;
    width: 100%;
    height: 45px;
    bottom: 0px;
    left: 0px;
    top: calc(100vh - 105px - 37px);
}

.map-overlay-yearsliderbox {
    background-color: #4E4E56;
    height: 45px;
    padding: 0px;
}

.map-overlay-infobox {
    font:  'Helvetica Neue', Arial, Helvetica, sans-serif !important;
    color: black;
    position: absolute;
    top: 0px;
    padding: 0px;
    box-shadow: 0 0 20px rgba(0,0,0,0.3);
    background-color: rgb(255,255,240);
    width: 16.6667%;
    width: calc(100% / 4);
    height: calc(100vh - 105px - 37px);
    /*background-image: url(https://www.toptal.com/designers/subtlepatterns/patterns/ricepaper2.png);*/
    overflow: scroll;
}

.map-overlay-infobox-content {
      font:  'Helvetica Neue', Arial, Helvetica, sans-serif !important;

}
    
.map-overlay-yearbox {
    position: absolute;
    top: 0px;
    right: 53px;
    padding: 10px;
    background-color: transparent;
    width: 100%
    text-align: center;
    font-family: sans-serif;
    font-size: 50px;
    text-shadow: 2px 2px 15px rgba(255, 255, 255, 0.5);
    color: rgba(50, 50, 50, 0.7);
}

.map-overlay-eventbox {
    position: absolute;
    bottom: 10px;
    right: calc(75vw / 2 - 350px);
    padding: 3px;
    background-color: rgba(255, 255, 240, 0.5);
    width: 110%;
    max-width: 700px;
    text-align: center;
    font-family: sans-serif;
    font-size: 27px;
    text-shadow: 2px 2px 15px rgba(255, 255, 255, 0.5);
    color: rgba(50, 50, 50, 1);
    box-shadow: 2px 2px 15px rgba(0, 0, 0, 0.5);
    display: inline;
}









.map-overlay-yearsliderbox h2 {
    line-height: 24px;
    display: block;
    margin: 0 0 10px;
}

.map-overlay-yearsliderbox input {
/*    display: inline-block;
    width: 90%;
    position: relative;
    margin: 0;
    margin-left: 5%;
    cursor: ew-resize;
    padding-top: -45px;
*/
    background-color: #4E4E56;

}

/*#yearlable {
    color: white; 
    font-size: 23px; 
    text-align: center;
    margin-left: 50%
}*/

#slider { 
    position:relative;

}
#slider:after {
    content:'';
    position:absolute;
    top:-10px; bottom:-10px; 
    left:-10px; right:-10px; 
}

.infobox_info_div {
    padding: 15px;
    font-family: sans-serif;
}

#infobox_info {
    text-align: justify;
}

#infobox_date {
    font-size: 22px;
    -webkit-margin-after: -0.7em;
  }

#infobox_name {
    font-size: 24px;
    text-align: center;
}

/*.infobox_name_div {
background-color: #e45555 !important;
margin: 0px;
padding-top: 1em;
padding-bottom: 1em;
}*/







.btn_div {
  /*width: 100%;*/

}

.info_btn {
  -webkit-border-radius: 5;
  -moz-border-radius: 5;
  border-radius: 5px;
  font-family: Arial;
  color: #ffffff;
  font-size: 20px;
  background: #4d4d56;
  padding: 10px 20px 10px 20px;
  border: dotted #1f628d 0px;
  text-decoration: none;
}

.info_btn:hover {
  background: #e45555;
  text-decoration: none;
}

    #menu {
        background: #fff;
        position: absolute;
        z-index: 1;
        bottom: 10px;
        right: 27px;
        border-radius: 3px;
        width: auto;
        /*border: 1px solid rgba(0,0,0,0.4);*/
        font-family: 12px/20px 'Open Sans', sans-serif;
        box-shadow: 0 0 20px rgba(0,0,0,0.3);
        line-height: 1em;

    }

    #menu a {
        font-size: 13px;
        color: #404040;
        display: block;
        margin: 0;
        padding: 0;
        padding: 6px;
        text-decoration: none;
        border-bottom: 1px solid rgba(0,0,0,0.25);
        text-align: center;
    }
    #menu p {
        font-size: 13px;
        color: #fff;
        background-color: #4d4d56;  
        display: block;
        margin: 0;
        padding: 0;
        padding: 6px;
        text-decoration: none;
        border-bottom: 1px solid rgba(0,0,0,0.25);
        text-align: center;
    }

    #menu a:last-child {
        border: none;
    }

    #menu a:hover {
        background-color: #3887be;
        color: #404040;
    }

    #menu a.active {
        background-color: #3887be;
        color: #ffffff;
    }

    #menu a.active:hover {
        background: #3074a4;
    }

    .h_iframe {
      position: relative; 
      padding-top: 56%;
    }

    .h_iframe iframe {
      position:absolute;
      top:0;
      left:0;
      width:100%; 
      height:100%;
    }

    #youtube_demo {
      display: none;
      position: absolute;
      margin: auto;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      padding: 10px;
      box-shadow: 2px 2px 15px rgba(0, 0, 0, 0.5);
      background-color: rgba(255, 255, 240, 1);
    }










input[type=range].slider {
  -webkit-appearance: none;
    display: inline-block;
    width: 90%;
    position: relative;
    margin: 0;
    margin-top: 20px;
    margin-left: 5% !important;
    cursor: ew-resize;
    padding-top: -45px;
}
input[type=range].slider:focus {
  outline: none;
}
input[type=range].slider::-webkit-slider-runnable-track {
  width: 100%;
  height: 7.3px;
  cursor: pointer;
  box-shadow: 2.7px 2.7px 4.6px rgba(0, 0, 0, 0.32), 0px 0px 2.7px rgba(13, 13, 13, 0.32);
  background: rgba(199, 199, 199, 0.61);
  border-radius: 5.1px;
  border: 0px solid #010101;
}
input[type=range].slider::-webkit-slider-thumb {
  box-shadow: 1.4px 1.4px 5.6px rgba(0, 0, 0, 0.37), 0px 0px 1.4px rgba(13, 13, 13, 0.37);
  border: 0.4px solid #000000;
  height: 36px;
  width: 16px;
  border-radius: 3px;
  background: #da635d;
  cursor: pointer;
  -webkit-appearance: none;
  margin-top: -14.35px;
}
input[type=range].slider:focus::-webkit-slider-runnable-track {
  background: rgba(199, 199, 199, 0.61);
}
input[type=range].slider::-moz-range-track {
  width: 100%;
  height: 7.3px;
  cursor: pointer;
  box-shadow: 2.7px 2.7px 4.6px rgba(0, 0, 0, 0.32), 0px 0px 2.7px rgba(13, 13, 13, 0.32);
  background: rgba(199, 199, 199, 0.61);
  border-radius: 5.1px;
  border: 0px solid #010101;
}
input[type=range].slider::-moz-range-thumb {
  box-shadow: 1.4px 1.4px 5.6px rgba(0, 0, 0, 0.37), 0px 0px 1.4px rgba(13, 13, 13, 0.37);
  border: 0.4px solid #000000;
  height: 36px;
  width: 16px;
  border-radius: 3px;
  background: #da635d;
  cursor: pointer;
}
input[type=range].slider::-ms-track {
  width: 100%;
  height: 7.3px;
  cursor: pointer;
  background: transparent;
  border-color: transparent;
  color: transparent;
}
input[type=range].slider::-ms-fill-lower {
  background: rgba(199, 199, 199, 0.61);
  border: 0px solid #010101;
  border-radius: 10.2px;
  box-shadow: 2.7px 2.7px 4.6px rgba(0, 0, 0, 0.32), 0px 0px 2.7px rgba(13, 13, 13, 0.32);
}
input[type=range].slider::-ms-fill-upper {
  background: rgba(199, 199, 199, 0.61);
  border: 0px solid #010101;
  border-radius: 10.2px;
  box-shadow: 2.7px 2.7px 4.6px rgba(0, 0, 0, 0.32), 0px 0px 2.7px rgba(13, 13, 13, 0.32);
}
input[type=range].slider::-ms-thumb {
  box-shadow: 1.4px 1.4px 5.6px rgba(0, 0, 0, 0.37), 0px 0px 1.4px rgba(13, 13, 13, 0.37);
  border: 0.4px solid #000000;
  height: 36px;
  width: 16px;
  border-radius: 3px;
  background: #da635d;
  cursor: pointer;
  height: 7.3px;
}
input[type=range].slider:focus::-ms-fill-lower {
  background: rgba(199, 199, 199, 0.61);
}
input[type=range].slider:focus::-ms-fill-upper {
  background: rgba(199, 199, 199, 0.61);
}




</style>
<nav id="menu"><p>Maps:</p></nav>
<div id='map'></div>
<div class='map-overlay-yearsliderbox' id='yearsliderbox'>
<!--         <label id='yearlable'></label>
 --><!--         <button onclick="myFunction()">  +1  </button> -->
        <input  id='slider' class='slider' type='range' min='1960' max='2016' step='1' value='2002'/>        
    </div>
<div class='map-overlay-infobox'>
        <div class='map-overlay-infobox-content'>
                  <div class='infobox_name_div'>
                      <p id="infobox_name">UT Campus Prototype <br><br> 
<!--                           <div class="h_iframe">
                              <iframe width="560" height="315" src="https://www.youtube.com/embed/QkS1VIVnRLk" frameborder="0" allowfullscreen>
                             </iframe>
                         </div>  
 -->                      </p>
                  </div>
            <div class='infobox_img_div'>
                <a id="infobox_imgurl" href="" target="_blank"><img id="infobox_img" src="" style="max-width: 100%; max-height: 100%;"></a>
            </div>
    
            <div class='infobox_date_div'>
                <p id="infobox_date" style='text-align: center;'></p>
            </div>
            <div class='infobox_info_div'>
                <p id="infobox_info">
                  <button type="button" class="info_btn" onclick="document.getElementById('youtube_demo').style.display = 'inline'">Demo</button></br></br>
                  <b>Change the year by moving the slider at the bottom.</b></br>Click on the map features for more information.</br>For any questions or bugs feel free to use the <a href="https://app.purechat.com/w/MapofHumanity" style="text-decoration: underline;">chat box</a> or <a href="mailto:daan@mapofhumanity.org?Subject=I%20was%20looking%20at%20mapofhumanity.org/prototype" style="text-decoration: underline;">email me</a>.</br>Map of Humanity is participating in the UT challenge, <b>help us win</b> by voting for us!</br> </br><a href="https://utchallenge.nl/candidate/details/14193/" target="_blank"><button class="info_btn" type="button">Vote for us!</button></a>
                </p>
            </div>
        </div>
        <div class='infobox_howto_div'></div>
    </div>
  <div class='map-overlay-yearbox'> <label id='yearlable'></label> </div>
  <div class='map-overlay-eventbox' id='map-overlay-eventbox'> <label id='eventlable'></label> </div>
  <div id='youtube_demo'> 
      <iframe width="560" height="315" src="https://www.youtube.com/embed/QkS1VIVnRLk" frameborder="0" allowfullscreen></iframe> 
    </br>
      <button type="button" class="info_btn" onclick="document.getElementById('youtube_demo').style.display = 'none'">Done</button>
  </div>
</div> 

<!-- <pre id='features'></pre>
 -->
<script>
$('#map-overlay-eventbox').hide();

mapboxgl.accessToken = 'pk.eyJ1IjoiZGFhbnZyIiwiYSI6ImNpdTJmczN3djAwMHEyeXBpNGVndWtuYXEifQ.GYZf7r9gTfQL3W-GpmmJ3A';

var map = new mapboxgl.Map({
    container: 'map',
    style: 'mapbox://styles/daanvr/ciw1eozkr00dd2jscswkbdfvg',
    center: [6.85220718383789, 52.24346350501319],
    zoom: 16,
    bearing: 10,
    pitch: 20,
    maxBounds: [[6.805686225891112, 52.223266707775876], [6.891775856018066, 52.264813883912355]],
    minZoom: 14
});

// function myFunction() {
//     document.getElementById("slider").stepUp(1);
//         console.log("+1 test!");

// }



map.on('click', function (e) {
    var features = map.queryRenderedFeatures(e.point, {});
    if (!features.length) {return;}
    var feature = features[0];
    
    document.getElementById('infobox_img').setAttribute('src', feature.properties.img);
    document.getElementById('infobox_imgurl').setAttribute('href', feature.properties.imgurl);
    document.getElementById('infobox_name').innerHTML = (feature.properties.name);
    document.getElementById('infobox_info').innerHTML = (feature.properties.info);
    document.getElementById('infobox_date').innerHTML = (feature.properties.start_date + " - " +feature.properties.end_date);
});

map.addControl(new mapboxgl.NavigationControl());


// map.on('load', function () {
//     // Change the cursor to a pointer when the mouse is over the places layer.
//     map.on('mouseenter', 'pois', function () {
//         map.getCanvas().style.cursor = 'pointer';
//     });

//     // Change it back to a pointer when it leaves.
//     map.on('mouseleave', 'pois', function () {
//         map.getCanvas().style.cursor = '';
//     });
// });



$(document).ready(function() {
    console.log("ready!");

    function filterBy(year) {
        var yearvar = document.getElementById("slider").value;
        var yearplus1N = Number(yearvar) + 1;
        var yearminus1N = Number(yearvar) - 1;
        var yearplus2N = Number(yearvar) + 2;
        var yearminus2N = Number(yearvar) - 2;
        var yearplus1 = yearplus1N.toString();
        var yearminus1 = yearminus1N.toString();
        var yearplus2 = yearplus2N.toString();
        var yearminus2 = yearminus2N.toString();

        map.setFilter('buildingslayer', [ "all", ['<=', 'start_date', year], ['>=', 'end_date', year]]);            //Buildings timeline
        map.setFilter('buildingslayer_name', [ "all", ['<=', 'start_date', year], ['>=', 'end_date', year]]);            //Buildings timeline
        map.setFilter('buildingslayer_shadow', [ "all", ['<=', 'start_date', year], ['>=', 'end_date', year]]);       //Buildings shadow timeline
        map.setFilter('waterlayer', [ "all", ['<=', 'start_date', year], ['>=', 'end_date', year]]);                //Water timeline
        map.setFilter('waysdataset', [ "all", ['<=', 'start_date', year], ['>=', 'end_date', year]]);               //Roads timeline
        map.setFilter('waysdataset_shadow', [ "all", ['<=', 'start_date', year], ['>=', 'end_date', year]]);          //Roads timeline
        map.setFilter('pois', [ "all", ['<=', 'start_date', year], ['>=', 'end_date', year]]);                      //Roads timeline
        map.setFilter('sports', [ "all", ['<=', 'start_date', year], ['>=', 'end_date', year]]);                      //Roads timeline
        map.setFilter('sports_name', [ "all", ['<=', 'start_date', year], ['>=', 'end_date', year]]);                      //Roads timeline
        map.setFilter('forestcampus', [ "all", ['<=', 'start_date', year], ['>=', 'end_date', year]]);                      //Roads timeline
        map.setFilter('photos', [ "any", ['==', 'date', year], ['==', 'date', yearplus1], ['==', 'date', yearminus1], ['==', 'date', yearplus2], ['==', 'date', yearminus2]]);                      //photo_pois timeline
        
        // Set the label above the selecor to the year
        //document.getElementById('yearlable').textContent = year;
        document.getElementById('yearlable').textContent = year;

        if (year == 1960) {
          document.getElementById('eventlable').textContent = "1960: The Drienerlo estate";
          $('#map-overlay-eventbox').show(); };
        if (year == 1961) {
          document.getElementById('eventlable').textContent = "1961: Official announcement of the THT";
          $('#map-overlay-eventbox').show(); };
        if (year == 1962) {
          document.getElementById('eventlable').textContent = "1962: Start of the construction works";
          $('#map-overlay-eventbox').show(); };
        if (year == 1964) {
          document.getElementById('eventlable').textContent = "1964: The first students arrive!";
          $('#map-overlay-eventbox').show(); };
        if (year == 1986) {
          document.getElementById('eventlable').textContent = "1986: The THT becomes the University of Twente";
          $('#map-overlay-eventbox').show(); };
        if (year == 2002) {
          document.getElementById('eventlable').textContent = "2002: Fire in the Cubicus destroying the east wing";
          $('#map-overlay-eventbox').show(); };

        if (year != 1986 && year != 1961 && year != 1962 && year != 1964 && year != 2002)  {
          document.getElementById('eventlable').textContent = "";
          $('#map-overlay-eventbox').hide(); };
    }


    map.on('load', function test() {
        // Set filter to first year of the year
        filterBy("" + 2002 + "");

        document.getElementById('slider').addEventListener('change', function(e) {
            var year = "" + parseInt(e.target.value, 10) + "";
            filterBy(year);
        });
    });




});
//The values in this variable are the layer names that will have a toggle.
var toggleableLayerIds = ['1960', '1963', '1965', '1968', '2003' ];

//The following code is to creatie the  buttons to toggle layers ON or OFF. This will be used to show layers of scanned maps.
for (var i = 0; i < toggleableLayerIds.length; i++) { //begining of the 
    var id = toggleableLayerIds[i];

    var link = document.createElement('a');
    link.href = '#';
    link.className = '';
    link.textContent = id;

    link.onclick = function (e) {
        var clickedLayer = this.textContent;
        e.preventDefault();
        e.stopPropagation();

        var visibility = map.getLayoutProperty(clickedLayer, 'visibility');

        if (visibility === 'visible') {
            map.setLayoutProperty(clickedLayer, 'visibility', 'none');
            this.className = '';
        } else {
            this.className = 'active';
            map.setLayoutProperty(clickedLayer, 'visibility', 'visible');
        }
    };
    var layers = document.getElementById('menu');
    layers.appendChild(link);
}

    map.flyTo({
        center: [6.85220718383789, 52.24346350501319],
        zoom: 14.3,
        pitch: 0,
        bearing: 14,
        speed: 0.3, // make the flying slow
        curve: 1, // change the speed at which it zooms out
    });
</script>