<script src="https://code.jquery.com/jquery-3.1.1.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>
<script src='https://api.mapbox.com/mapbox-gl-js/v0.28.0/mapbox-gl.js'></script>
<link href='https://api.mapbox.com/mapbox-gl-js/v0.28.0/mapbox-gl.css' rel='stylesheet' />
<style>

body {
    display: block;
    margin: 0px;
/*  border: 1px solid transparent;
    padding-bottom: 20px;
*/
}

#map {
    width: 100%;
    height: calc(100vh - 90px);
    margin: 0px;
/*    margin-bottom: 45px;
*/}

#map canvas {
    cursor: crosshair;
}

.map-overlay-yearsliderbox {
    font: 12px/20px 'Helvetica Neue', Arial, Helvetica, sans-serif;
    position: absolute;
    width: 100%;
    height: 45px;
    bottom: 0;
    left: 0;
    top: calc(100vh - 90px - 45px);
}

.map-overlay-yearsliderbox {
    background-color: #4E4E56;
    height: 45px;
    padding: 0px;
}

.map-overlay-infobox {
    font: 12px/20px 'Helvetica Neue', Arial, Helvetica, sans-serif;
    color: black;
    position: absolute;
    top: 0px;
    padding: 0px;
    box-shadow: 0 0 20px rgba(0,0,0,0.3);
    background-color: rgb(255,255,240);
    width: 16.6667%;
    width: calc(100% / 4);
    height: calc(100vh - 90px - 45px);
    background-image: url(https://www.toptal.com/designers/subtlepatterns/patterns/ricepaper2.png);
    overflow: scroll;
}

.map-overlay-infobox-content {
}
    
.map-overlay-eventbox {
    position: absolute;
    /*width: 200px;*/
    top: 10px;
    right: 25px;
    padding: 10px;
    background-color: #fff;
    border-style: solid;
    border-width: 1px;
    width: 30%; /* fallback for non-calc() browsers */
    width: calc(100% / 3);
}


.map-overlay-yearsliderbox h2 {
    line-height: 24px;
    display: block;
    margin: 0 0 10px;
}

.map-overlay-yearsliderbox input {
    background-color: red;
    display: inline-block;
    width: 90%;
    position: relative;
    margin: 0;
    margin-left: 5%;
    cursor: ew-resize;
    padding-top: -45px;
}

#yearlable {
    color: white; 
    font-size: 200%; 
    text-align: center;
    margin-left: 50%
}

#slider { 
    position:relative;

}
#slider:after {
    content:'';
    position:absolute;
    top:-10px; bottom:-10px; 
    left:-10px; right:-10px; 
}

.infobox_info_div {
    padding: 15px;
}

#infobox_info {
    text-align: justify;
}

#infobox_date {

}


.info_btn {
  -webkit-border-radius: 5;
  -moz-border-radius: 5;
  border-radius: 5px;
  font-family: Arial;
  color: #ffffff;
  font-size: 20px;
  background: #4d4d56;
  padding: 10px 20px 10px 20px;
  border: dotted #1f628d 0px;
  text-decoration: none;
}

.info_btn:hover {
  background: #e45555;
  text-decoration: none;
}


</style>
<div id='map'></div>
<div class='map-overlay-yearsliderbox' id='yearsliderbox'>
        <label id='yearlable'></label>
        <input id='slider' type='range' min='1960' max='2016' step='1' value='2000' />        
    </div>
<div class='map-overlay-infobox'>
        <div class='map-overlay-infobox-content'>
            <div class='infobox_img_div'>
                <a id="infobox_imgurl" href="" target="_blank"><img id="infobox_img" src="" style="max-width: 100%; max-height: 100%;"></a>
            </div>
            <div class='infobox_name_div'>
                <p id="infobox_name" style='font-size: 200%; text-align: center;'>UT Campus Prototype</p>
            </div>
            <div class='infobox_date_div'>
                <p id="infobox_date" style='text-align: center;'></p>
            </div>
            <div class='infobox_info_div'>
                <p id="infobox_info">Click on the map features for more information.</br>For any questions or bugs feel free to use the <a href="https://app.purechat.com/w/MapofHumanity" style="text-decoration: underline;">chat box</a> or <a href="mailto:daan@mapofhumanity.org?Subject=I%20was%20looking%20at%20mapofhumanity.org/prototype" style="text-decoration: underline;">email me</a>.</br></br>Map of Humanity is participating in the UT challenge, <b>help us win</b> by voting for us!</br> <a href="https://utchallenge.nl/candidate/details/14193/" target="_blank"><button class="info_btn" type="button">Vote for us!</button></a>
                </p>
            </div>
        </div>
        <div class='infobox_howto_div'></div>

</div>

<!-- <div class='map-overlay-eventbox'>
        <label id='infobox'>2002: brandde een deel van de Cubicus af door brandstichting.</label>
    </div>
</div> 
<pre id='features'></pre>-->
<script>
mapboxgl.accessToken = 'pk.eyJ1IjoiZGFhbnZyIiwiYSI6ImNpdTJmczN3djAwMHEyeXBpNGVndWtuYXEifQ.GYZf7r9gTfQL3W-GpmmJ3A';

var map = new mapboxgl.Map({
    container: 'map',
    style: 'mapbox://styles/daanvr/ciw1eozkr00dd2jscswkbdfvg',
    center: [6.85220718383789, 52.24346350501319],
    zoom: 13,
    bearing: 10,
    pitch: 20,
    maxBounds: [[6.707661056518555, 52.184750061441355], [6.951517639160156, 52.30476134255271]]
});

map.on('click', function (e) {
    var features = map.queryRenderedFeatures(e.point, {});
    if (!features.length) {return;}
    var feature = features[0];
    
    document.getElementById('infobox_img').setAttribute('src', feature.properties.img);
    document.getElementById('infobox_imgurl').setAttribute('href', feature.properties.imgurl);
    document.getElementById('infobox_name').innerHTML = (feature.properties.name);
    document.getElementById('infobox_info').innerHTML = (feature.properties.info);
    document.getElementById('infobox_date').innerHTML = (feature.properties.start_date + " - " +feature.properties.end_date);
});

$(document).ready(function() {
    console.log("ready!");

    function filterBy(year) {
        map.setFilter('buildingslayer', [ "all", ['<=', 'start_date', year], ['>=', 'end_date', year]]);            //Buildings timeline
        map.setFilter('buildingslayer_name', [ "all", ['<=', 'start_date', year], ['>=', 'end_date', year]]);            //Buildings timeline
        map.setFilter('buildingslayer_shadow', [ "all", ['<=', 'start_date', year], ['>=', 'end_date', year]]);       //Buildings shadow timeline
        map.setFilter('waterlayer', [ "all", ['<=', 'start_date', year], ['>=', 'end_date', year]]);                //Water timeline
        //map.setFilter('forestlayer', [ "all", ['<=', 'start_date', year], ['>=', 'end_date', year]]);             //Forest timeline
        //map.setFilter('grasslayer', [ "all", ['<=', 'start_date', year], ['>=', 'end_date', year]]);            //Grass timeline
        map.setFilter('waysdataset', [ "all", ['<=', 'start_date', year], ['>=', 'end_date', year]]);               //Roads timeline
        map.setFilter('waysdataset_shadow', [ "all", ['<=', 'start_date', year], ['>=', 'end_date', year]]);          //Roads timeline
        map.setFilter('pois', [ "all", ['<=', 'start_date', year], ['>=', 'end_date', year]]);                      //Roads timeline
        map.setFilter('sports', [ "all", ['<=', 'start_date', year], ['>=', 'end_date', year]]);                      //Roads timeline
        map.setFilter('sports_name', [ "all", ['<=', 'start_date', year], ['>=', 'end_date', year]]);                      //Roads timeline
        map.setFilter('forestcampus', [ "all", ['<=', 'start_date', year], ['>=', 'end_date', year]]);                      //Roads timeline
        
        // Set the label above the selecor to the year
        document.getElementById('yearlable').textContent = year;
    }

    map.on('load', function test() {
        // Set filter to first year of the year
        filterBy("" + 2000 + "");

        document.getElementById('slider').addEventListener('input', function(e) {
            var year = "" + parseInt(e.target.value, 10) + "";
            filterBy(year);
        });
    });

    map.flyTo({
        center: [6.85220718383789, 52.24346350501319],
        zoom: 14,
        pitch: 0,
        bearing: 15,
        speed: 0.5, // make the flying slow
        curve: 1, // change the speed at which it zooms out
    });

    

});
</script>